{% extends 'todo/base.html' %}
{% load dict_extras %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<h1>Dashboard</h1>

<div class="dashboard-container">
  <!-- Left Column: Dashboard Summary -->
  <div class="dashboard-summary">
    <p><strong>Total Tasks:</strong> {{ total_tasks }}</p>
    <p><strong>Completed Tasks:</strong> {{ completed_tasks }}</p>
    <p><strong>Pending Tasks:</strong> {{ pending_tasks }}</p>
    
    <h2>Task Summary by Status</h2>
    <ul>
      {% for status, count in summary.items %}
         <li>{{ status }}: {{ count }}</li>
      {% endfor %}
    </ul>
  </div>
  
  <!-- Right Column: Pie Chart -->
  <div class="dashboard-chart">
    <h2>Task Completion</h2>
    <canvas id="taskPieChart"></canvas>
  </div>
</div>

<!-- Load Chart.js from CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var ctx = document.getElementById('taskPieChart').getContext('2d');
    var taskPieChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Completed', 'Pending'],
            datasets: [{
                data: [{{ completed_tasks }}, {{ pending_tasks }}],
                backgroundColor: ['green', 'red']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
        }
    });
});
</script>
<style>
/* Ensure border-box sizing for all elements */
* {
  box-sizing: border-box;
}

/* Dashboard container: using flex with wrap on small screens, no wrap on larger screens */
.dashboard-container {
  display: flex;
  flex-wrap: wrap; /* allow stacking on small screens */
  align-items: flex-start; /* align columns at the top */
  gap: 20px;
  margin: 0 auto;
  padding: 15px;
  width: 100%;
}

/* For mobile devices, let columns take full width */
.dashboard-summary,
.dashboard-chart {
  flex: 1 1 100%;
}

/* For larger screens, force the columns to remain side by side */
@media (min-width: 768px) {
  .dashboard-summary,
  .dashboard-chart {
    flex: 1 1 48%; /* Adjust percentage as needed */
  }
}

/* Chart container styling */
.dashboard-chart {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  /* Set a minimum height for the chart container */
  min-height: 300px;
}

/* Ensure the canvas is responsive */
.dashboard-chart canvas {
  width: 100% !important;
  height: auto !important;
}

</style>

{% endblock %}
